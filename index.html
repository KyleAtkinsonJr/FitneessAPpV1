<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fitness Tracker</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="data:," />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900 font-sans">
  <div id="root" class="max-w-2xl mx-auto p-4"></div>

  <!-- React, ReactDOM (Client build for React 18), Babel -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.client.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { createRoot } = ReactDOM;

    const MOTIVATION_QUOTES = [
      "The only bad workout is the one that didn't happen.",
      "Push yourself because no one else is going to do it for you.",
      "Success is earned one rep at a time.",
    ];

    const today = new Date().toISOString().split("T")[0];
    const getWeekNumber = (date) => {
      const d = new Date(date.getTime());
      d.setHours(0, 0, 0, 0);
      d.setDate(d.getDate() + 3 - ((d.getDay() + 6) % 7));
      const week1 = new Date(d.getFullYear(), 0, 4);
      return 1 + Math.round(((d - week1) / 86400000 - 3 + ((week1.getDay() + 6) % 7)) / 7);
    };
    const week = getWeekNumber(new Date());
    const currentWeekKey = `week-${week}`;
    const previousWeekKey = `week-${week - 1}`;

    const WORKOUTS = [
      { id: 'squats', name: 'Squats', sets: 3, reps: 12 },
      { id: 'pushups', name: 'Push-ups', sets: 3, reps: 15 }
    ];

    const App = () => {
      const [quote, setQuote] = useState('');
      const [data, setData] = useState(() => JSON.parse(localStorage.getItem(currentWeekKey) || '{}'));
      const [prevData, setPrevData] = useState(() => JSON.parse(localStorage.getItem(previousWeekKey) || '{}'));

      useEffect(() => {
        const savedDate = localStorage.getItem("quote-date");
        const savedQuote = localStorage.getItem("quote-text");
        if (savedDate !== today || !savedQuote) {
          const newQuote = MOTIVATION_QUOTES[Math.floor(Math.random() * MOTIVATION_QUOTES.length)];
          localStorage.setItem("quote-date", today);
          localStorage.setItem("quote-text", newQuote);
          setQuote(newQuote);
        } else {
          setQuote(savedQuote);
        }
      }, []);

      const updateSet = (exerciseId, setIndex, field, value) => {
        const updated = { ...data };
        if (!updated[exerciseId]) updated[exerciseId] = {};
        if (!updated[exerciseId][`set-${setIndex}`]) {
          updated[exerciseId][`set-${setIndex}`] = { weight: '', completed: false };
        }
        updated[exerciseId][`set-${setIndex}`][field] =
          field === 'completed' ? value : Number(value);
        setData(updated);
        localStorage.setItem(currentWeekKey, JSON.stringify(updated));
      };

      return (
        <main className="bg-white rounded-xl shadow-md p-6 space-y-6">
          <h1 className="text-3xl font-bold text-center">üèãÔ∏è Fitness Tracker</h1>
          <div className="text-center bg-blue-100 text-blue-800 px-4 py-3 rounded">
            ‚Äú{quote}‚Äù
          </div>

          <section>
            <h2 className="text-xl font-semibold mb-2">Today's Workout</h2>
            {WORKOUTS.map(ex => (
              <div key={ex.id} className="mb-4 border-b pb-2">
                <h3 className="font-medium">{ex.name} ‚Äî {ex.reps} reps x {ex.sets} sets</h3>
                <div className="grid grid-cols-1 sm:grid-cols-3 gap-2 mt-2">
                  {Array.from({ length: ex.sets }).map((_, i) => {
                    const current = data[ex.id]?.[`set-${i}`] || {};
                    const previous = prevData[ex.id]?.[`set-${i}`] || {};
                    return (
                      <div key={i} className="border p-2 rounded space-y-1 text-sm">
                        <label className="block font-medium">Set {i + 1}</label>
                        <input
                          type="number"
                          className="border rounded w-full px-2 py-1"
                          placeholder="Weight (kg)"
                          value={current.weight ?? ''}
                          onChange={(e) => updateSet(ex.id, i, 'weight', e.target.value)}
                        />
                        <label className="inline-flex items-center">
                          <input
                            type="checkbox"
                            className="mr-2"
                            checked={current.completed || false}
                            onChange={(e) => updateSet(ex.id, i, 'completed', e.target.checked)}
                          />
                          Completed
                        </label>
                        {previous.weight && (
                          <p className="text-xs text-gray-500">Prev: {previous.weight}kg</p>
                        )}
                      </div>
                    );
                  })}
                </div>
              </div>
            ))}
          </section>
        </main>
      );
    };

    const root = createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>

  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js')
          .then(reg => console.log('Service Worker registered:', reg))
          .catch(err => console.warn('SW registration failed:', err));
      });
    }
  </script>
</body>
</html>
